---
- name: Project 3 - LAMP Stack Automation
  hosts: web
  become: yes

  tasks:
    - name: Install Apache web server
      ansible.builtin.yum:
        name: httpd
        state: present

    - name: Start and enable Apache
      ansible.builtin.service:
        name: httpd
        state: started
        enabled: yes

    - name: Install MariaDB server (Amazon Linux 2023)
      ansible.builtin.yum:
        name: mariadb105-server
        state: present

    - name: Start and enable MariaDB
      ansible.builtin.service:
        name: mariadb
        state: started
        enabled: yes

    - name: Install PHP and required modules
      ansible.builtin.yum:
        name:
          - php
          - php-mysqlnd
        state: present

    - name: Deploy PHP test application
      ansible.builtin.copy:
        content: |
          <?php
          phpinfo();
          ?>
        dest: /var/www/html/index.php
        owner: apache
        group: apache
        mode: '0644'

    - name: Restart Apache after PHP deployment
      ansible.builtin.service:
        name: httpd
        state: restarted
